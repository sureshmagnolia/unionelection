<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Union Election - Student Portal</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .hidden { display: none !important; }
        
        /* PRINT STYLES (Crucial for the Nomination Paper) */
        @media print {
            body * { visibility: hidden; }
            #nomination-preview-container, #nomination-preview-container * { visibility: visible; }
            #nomination-preview-container { 
                position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; 
            }
            #btn-print-group, .no-print { display: none !important; }
        }
    </style>
<style>
        @media print {
            body * {
                visibility: hidden;
            }
            #nomination-preview-container, #nomination-preview-container * {
                visibility: visible;
                color: black !important;
                background: white !important;
                box-shadow: none !important;
                text-shadow: none !important;
            }
            #nomination-preview-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                border: 2px solid black !important; /* Force solid black border on print */
                padding: 20px !important;
                margin: 0 !important;
            }
            /* Hide buttons during print */
            #btn-print-group, #captcha-box { 
                display: none !important; 
            }
        }
    </style>


    
</head>
<body class="bg-gray-100 min-h-screen">

    <nav class="navbar navbar-dark bg-primary shadow-sm no-print">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">ðŸŽ“ Union Election 2025</a>
        </div>
    </nav>

    <div class="container mt-4">

        <div id="sec-search" class="row justify-content-center">
            <div class="col-md-6">
                <div class="card shadow p-4 text-center">
                    <h4 class="mb-3">Find Your Roll</h4>
                    <div class="input-group mb-3">
                        <input type="text" id="search-input" class="form-control form-control-lg" placeholder="Enter Admission Number">
                        <button class="btn btn-primary" onclick="window.App.Student.search()">Search</button>
                    </div>
                    <div id="search-error" class="text-danger fw-bold"></div>
                </div>
            </div>
        </div>


        <div id="sec-candidate-list" class="hidden mb-4">
                <div class="card shadow border-success">
                    <div class="card-header bg-success text-white text-center">
                        <h4 class="mb-0">âœ… Valid Nominated Candidates</h4>
                        <small>Official List for Election 2025</small>
                    </div>
                    <div class="card-body" id="candidate-list-container">
                        </div>
                </div>
            </div>



        
        <div id="sec-dashboard" class="hidden">
            <div class="card shadow-sm mb-4 border-start border-5 border-primary">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div>
                        <h2 id="st-name" class="h4 mb-0">Student Name</h2>
                        <p class="text-muted mb-0 small">
                            <span id="st-dept">Dept</span> | <span id="st-year">Year</span> | <span id="st-stream">Stream</span>
                        </p>
                    </div>
                    <div class="text-end">
                        <h5 class="text-primary" id="st-adm">#1234</h5>
                        <button class="btn btn-sm btn-outline-danger" onclick="location.reload()">Exit</button>
                    </div>
                </div>
            </div>
            
            <h5 class="mb-3">ðŸ“¢ Posts You Can Contest For</h5>
            <div id="eligible-posts-list" class="row g-3"></div>
            <div id="no-posts-msg" class="alert alert-warning hidden">No eligible posts found.</div>
        </div>

        <div id="sec-form" class="hidden max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8 space-y-6">
            
            <header class="text-center border-b pb-4">
                <h1 class="text-2xl font-bold text-gray-800">Nomination Form</h1>
                <p class="text-gray-500 text-sm">Post: <span id="display-post-name" class="font-bold text-blue-600"></span></p>
                <button onclick="window.App.UI.showSection('dashboard')" class="text-sm text-red-500 hover:underline mt-2">Cancel & Go Back</button>
            </header>

            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-md">
                <h3 class="font-bold text-yellow-800 text-sm">Disclaimer</h3>
                <p class="text-xs text-yellow-700 mt-1">
                    Responsibility for accuracy rests with the student. Any mistakes in the generated form will not be the responsibility of this system.
                </p>
            </div>

            <form onsubmit="event.preventDefault(); window.App.Student.generatePreview();" class="space-y-6">
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    
                    <div class="space-y-2">
                        <h3 class="font-semibold text-gray-800 border-b pb-1">1. Candidate</h3>
                        <label class="text-xs font-medium text-gray-700">Name</label>
                        <input type="text" id="frm-c-name" class="block w-full p-2 border bg-gray-100 rounded text-sm" readonly>
                        
                        <label class="text-xs font-medium text-gray-700">Adm No</label>
                        <input type="text" id="frm-c-adm" class="block w-full p-2 border bg-gray-100 rounded text-sm" readonly>
                        
                        <label class="text-xs font-medium text-gray-700">Date of Birth</label>
                        <input type="date" id="frm-dob" class="block w-full p-2 border border-gray-300 rounded text-sm" required onchange="window.App.Student.calcAge()">
                        <p id="age-display" class="text-xs text-blue-600 font-bold"></p>
                    </div>

                    <div class="space-y-2">
                        <h3 class="font-semibold text-gray-800 border-b pb-1">2. Proposer</h3>
                        <label class="text-xs font-medium text-gray-700">Admission Number</label>
                        <input type="text" id="frm-p-adm" class="block w-full p-2 border border-gray-300 rounded text-sm" 
                               onblur="window.App.Student.fetchStudentDetails('p')" placeholder="Enter Adm No">
                        <div id="p-details" class="text-xs text-gray-500 italic h-12">Checking...</div>
                    </div>

                    <div class="space-y-2">
                        <h3 class="font-semibold text-gray-800 border-b pb-1">3. Seconder</h3>
                        <label class="text-xs font-medium text-gray-700">Admission Number</label>
                        <input type="text" id="frm-s-adm" class="block w-full p-2 border border-gray-300 rounded text-sm" 
                               onblur="window.App.Student.fetchStudentDetails('s')" placeholder="Enter Adm No">
                        <div id="s-details" class="text-xs text-gray-500 italic h-12">Checking...</div>
                    </div>
                </div>

                <div class="text-center pt-4">
                    <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition font-semibold text-sm">
                        Generate Nomination Paper
                    </button>
                </div>
            </form>
        </div>



        <div id="nomination-preview-container" class="hidden max-w-4xl mx-auto bg-white p-8 mt-4 mb-8 border-2 border-black shadow-none text-black">
            
            <div class="flex justify-between mb-4 text-sm border-b-2 border-black pb-4">
                <div>
                    <p class="font-bold text-lg uppercase">Government Victoria College, Palakkad</p>
                    <p id="preview-date">Date: ...</p>
                </div>
                <div class="text-right">
                    <p class="text-xs uppercase font-bold">Serial Number</p>
                    <p id="prev-serial-display" class="font-bold text-3xl text-black">---</p>
                </div>
            </div>
            
            <h2 class="text-center font-bold text-2xl uppercase underline mb-8">Nomination Paper</h2>
        
            <div class="space-y-6 text-sm">
                <div class="flex items-end"><p class="w-1/3 font-bold text-base uppercase">Post Contesting For:</p><p id="prev-post" class="font-bold text-xl uppercase border-b border-black flex-grow"></p></div>
                
                <hr class="border-black">
        
                <h3 class="font-bold uppercase text-black text-lg mt-4 underline">Candidate Details</h3>
                <div class="grid grid-cols-2 gap-y-4 gap-x-8">
                    <div class="flex border-b border-black"><p class="w-24 font-semibold">Name:</p><p id="prev-c-name" class="font-bold uppercase"></p></div>
                    <div class="flex border-b border-black"><p class="w-24 font-semibold">Adm No:</p><p id="prev-c-adm" class="font-bold"></p></div>
                    <div class="flex border-b border-black"><p class="w-24 font-semibold">Dept:</p><p id="prev-c-dept" class="font-bold uppercase"></p></div>
                    <div class="flex border-b border-black"><p class="w-24 font-semibold">Year:</p><p id="prev-c-year" class="font-bold uppercase"></p></div>
                    <div class="flex border-b border-black"><p class="w-24 font-semibold">DOB:</p><p id="prev-c-dob" class="font-bold"></p></div>
                    <div class="flex border-b border-black"><p class="w-24 font-semibold">Age:</p><p id="prev-c-age" class="font-bold"></p></div>
                </div>
                <hr class="border-black">
        
                <h3 class="font-bold uppercase text-black text-lg mt-4 underline">Proposer Details</h3>
                <div class="grid grid-cols-2 gap-y-4 gap-x-8">
                    <div class="flex border-b border-black"><p class="w-24 font-semibold">Name:</p><p id="prev-p-name" class="font-bold uppercase"></p></div>
                    <div class="flex border-b border-black"><p class="w-24 font-semibold">Adm No:</p><p id="prev-p-adm" class="font-bold"></p></div>
                    <div class="flex border-b border-black"><p class="w-24 font-semibold">Dept:</p><p id="prev-p-dept" class="font-bold uppercase"></p></div>
                    <div class="flex border-b border-black"><p class="w-24 font-semibold">Year:</p><p id="prev-p-year" class="font-bold uppercase"></p></div>
                </div>
                <div class="mt-12 flex justify-between px-4">
                    <p>Date: ______/______/__________</p>
                    <div>
                        <p class="mb-2">Signature of Proposer:</p>
                        <div class="w-64 border-b-2 border-black"></div>
                    </div>
                </div>
                <hr class="border-black">
        
                <h3 class="font-bold uppercase text-black text-lg mt-4 underline">Seconder Details</h3>
                <div class="grid grid-cols-2 gap-y-4 gap-x-8">
                    <div class="flex border-b border-black"><p class="w-24 font-semibold">Name:</p><p id="prev-s-name" class="font-bold uppercase"></p></div>
                    <div class="flex border-b border-black"><p class="w-24 font-semibold">Adm No:</p><p id="prev-s-adm" class="font-bold"></p></div>
                    <div class="flex border-b border-black"><p class="w-24 font-semibold">Dept:</p><p id="prev-s-dept" class="font-bold uppercase"></p></div>
                    <div class="flex border-b border-black"><p class="w-24 font-semibold">Year:</p><p id="prev-s-year" class="font-bold uppercase"></p></div>
                </div>
                <div class="mt-12 flex justify-between px-4">
                    <p>Date: ______/______/__________</p>
                    <div>
                        <p class="mb-2">Signature of Seconder:</p>
                        <div class="w-64 border-b-2 border-black"></div>
                    </div>
                </div>
        
                <div class="text-center pt-10 mt-10 border-t-4 border-black">
                    <h3 class="font-bold mb-4 text-lg uppercase underline">Consent of the Candidate</h3>
                    <p class="mb-12 font-semibold italic">"I agree, if elected, to serve on the body to which I am proposed as a candidate."</p>
                    <div class="flex justify-between px-20">
                        <p>Date: ______/______/__________</p>
                        <div>
                            <p class="mb-2">Signature of Candidate:</p>
                            <div class="w-64 border-b-2 border-black"></div>
                        </div>
                    </div>
                    <p class="text-sm font-bold mt-8 uppercase border-t border-black pt-2">(To be signed in front of the Returning Officer)</p>
                </div>
            </div>

            <div id="captcha-box" class="max-w-md mx-auto p-4 mb-4 text-center border-2 border-black mt-8">
                <label class="block text-black font-bold mb-2 uppercase">Security Check</label>
                <div class="flex justify-center items-center gap-3">
                    <span class="text-xl font-mono px-3 py-1 border-2 border-black font-bold">
                        <span id="math-q">5 + 3</span> = ?
                    </span>
                    <input type="number" id="math-a" class="w-24 p-1 border-2 border-black text-center font-bold text-xl" placeholder="Ans">
                </div>
                <small class="text-black font-semibold">Solve to enable submission</small>
            </div>
        
            <div id="btn-print-group" class="text-center mt-8 space-x-4 border-t-2 border-black pt-6">
                <button id="btn-edit" onclick="window.App.Student.editForm()" class="bg-black text-white px-6 py-2 rounded-none hover:bg-gray-800 uppercase font-bold">Edit Details</button>
                <button id="btn-submit" onclick="window.App.Student.finalSubmit()" class="bg-black text-white px-6 py-2 rounded-none hover:bg-gray-800 font-bold uppercase shadow-none border-2 border-black">Confirm & Submit</button>
                
                <button id="btn-print" onclick="window.print()" class="hidden bg-white text-black px-8 py-3 rounded-none hover:bg-gray-200 font-bold text-lg shadow-none border-4 border-black uppercase">ðŸ–¨ Print Nomination Paper</button>
                <button id="btn-exit" onclick="location.reload()" class="hidden bg-white text-black px-6 py-3 rounded-none hover:bg-gray-200 border-2 border-black uppercase font-bold">Exit / New</button>
            </div>
        </div>

        

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import "./apps.js"; 
    </script>
</body>
</html>
